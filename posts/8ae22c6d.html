<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><title>ROS通信框架 | Malloy Yuan 的个人博客</title><meta name="keywords" content="ROS,Linux"><meta name="author" content="Malloy Yuan"><meta name="copyright" content="Malloy Yuan"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="机器人操作系统"><meta property="og:type" content="article"><meta property="og:title" content="ROS通信框架"><meta property="og:url" content="https://elec-creator.com/posts/8ae22c6d.html"><meta property="og:site_name" content="Malloy Yuan 的个人博客"><meta property="og:description" content="机器人操作系统"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/MCUheart/Hexo-blog-data@1.0.2/image/cover/post-cover/ros-cover.jpg"><meta property="article:published_time" content="2020-05-18T08:26:40.000Z"><meta property="article:modified_time" content="2022-02-10T03:46:06.118Z"><meta property="article:author" content="Malloy Yuan"><meta property="article:tag" content="ROS"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/MCUheart/Hexo-blog-data@1.0.2/image/cover/post-cover/ros-cover.jpg"><link rel="shortcut icon" href="/img/private/favicon.ico"><link rel="canonical" href="https://elec-creator.com/posts/8ae22c6d"><link rel="preconnect" href="//cdn.jsdelivr.net"><link rel="preconnect" href="//www.google-analytics.com" crossorigin=""><link rel="preconnect" href="//hm.baidu.com"><link rel="preconnect" href="//fonts.googleapis.com" crossorigin=""><link rel="preconnect" href="//busuanzi.ibruce.info"><link rel="manifest" href="/img/private/pwa/manifest.json"><meta name="msapplication-TileColor" content="#000000"><link rel="apple-touch-icon" sizes="180x180" href="/img/private/pwa/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/img/private/pwa/32.png"><link rel="icon" type="image/png" sizes="16x16" href="/img/private/pwa/16.png"><link rel="mask-icon" href="/img/private/pwa/safari-pinned-tab.svg" color="#5bbad5"><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload='this.media="all"'><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.css" media="print" onload='this.media="all"'><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script>(adsbygoogle=window.adsbygoogle||[]).push({google_ad_client:"ca-pub-6017375467561303",enable_page_level_ads:"true"})</script><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?f0eee211545bfd4d4a152fd36de6c1a1";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><script async src="https://www.googletagmanager.com/gtag/js?id=UA-161823084-1"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-161823084-1")</script><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web" media="print" onload='this.media="all"'><script>const GLOBAL_CONFIG={root:"/",algolia:void 0,localSearch:{path:"search.xml",languages:{hits_empty:"找不到您查询的内容：${query}"}},translate:{defaultEncoding:2,translateDelay:0,msgToTraditionalChinese:"繁",msgToSimplifiedChinese:"简"},noticeOutdate:void 0,highlight:{plugin:"highlighjs",highlightCopy:!0,highlightLang:!0,highlightHeightLimit:200},copy:{success:"复制成功",error:"复制错误",noSupport:"浏览器不支持"},relativeDate:{homepage:!1,post:!1},runtime:"天",date_suffix:{just:"刚刚",min:"分钟前",hour:"小时前",day:"天前",month:"个月前"},copyright:void 0,lightbox:"fancybox",Snackbar:void 0,source:{justifiedGallery:{js:"https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.js",css:"https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.css"}},isPhotoFigcaption:!1,islazyload:!0,isAnchor:!0}</script><script id="config-diff">var GLOBAL_CONFIG_SITE={title:"ROS通信框架",isPost:!0,isHome:!1,isHighlightShrink:!0,isToc:!0,postUpdate:"2022-02-10 11:46:06"}</script><noscript><style>#nav{opacity:1}.justified-gallery img{opacity:1}#post-meta time,#recent-posts time{display:inline!important}</style></noscript><script>(e=>{e.saveToLocal={set:function(e,t,o){if(0===o)return;const n=864e5*o,a={value:t,expiry:(new Date).getTime()+n};localStorage.setItem(e,JSON.stringify(a))},get:function(e){const t=localStorage.getItem(e);if(!t)return;const o=JSON.parse(t);if(!((new Date).getTime()>o.expiry))return o.value;localStorage.removeItem(e)}},e.getScript=e=>new Promise((t,o)=>{const n=document.createElement("script");n.src=e,n.async=!0,n.onerror=o,n.onload=n.onreadystatechange=function(){const e=this.readyState;e&&"loaded"!==e&&"complete"!==e||(n.onload=n.onreadystatechange=null,t())},document.head.appendChild(n)}),e.activateDarkMode=function(){document.documentElement.setAttribute("data-theme","dark"),null!==document.querySelector('meta[name="theme-color"]')&&document.querySelector('meta[name="theme-color"]').setAttribute("content","#0d0d0d")},e.activateLightMode=function(){document.documentElement.setAttribute("data-theme","light"),null!==document.querySelector('meta[name="theme-color"]')&&document.querySelector('meta[name="theme-color"]').setAttribute("content","#ffffff")};const t=saveToLocal.get("theme");"dark"===t?activateDarkMode():"light"===t&&activateLightMode();const o=saveToLocal.get("aside-status");void 0!==o&&("hide"===o?document.documentElement.classList.add("hide-aside"):document.documentElement.classList.remove("hide-aside"));/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)&&document.documentElement.classList.add("apple")})(window)</script><link rel="stylesheet" href="//at.alicdn.com/t/font_1975360_mudsyg8elc9.css"><style>.app-refresh{position:fixed;top:-2.2rem;left:0;right:0;z-index:99999;padding:0 1rem;font-size:15px;height:2.2rem;transition:all .3s ease}.app-refresh-wrap{display:flex;color:#fff;height:100%;align-items:center;justify-content:center}.app-refresh-wrap a{color:#fff;text-decoration:underline;cursor:pointer}</style><meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="/atom.xml" title="Malloy Yuan 的个人博客" type="application/atom+xml"></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/private/loading-4.gif" data-lazy-src="https://cdn.jsdelivr.net/gh/MCUheart/Hexo-blog-data@1.0.2/image/portrait/portrait-3.jpg" onerror='onerror=null,src="/img/private/site_img-load-404-1.gif"' alt="avatar"></div><div class="site-data is-center"><div class="data-item"><a href="/archives/"><div class="headline">文章</div><div class="length-num">54</div></a></div><div class="data-item"><a href="/tags/"><div class="headline">标签</div><div class="length-num">34</div></a></div><div class="data-item"><a href="/categories/"><div class="headline">分类</div><div class="length-num">37</div></a></div></div><hr><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i> <span>主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i> <span>时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i> <span>标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i> <span>分类</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);" rel="external nofollow noreferrer"><i class="fa-fw fas fa-list"></i> <span>娱乐</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i> <span>音乐</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-film"></i> <span>电影</span></a></li><li><a class="site-page child" href="/gallery/"><i class="fa-fw fas fa-camera-retro"></i> <span>照片</span></a></li><li><a class="site-page child" href="/books/"><i class="fa-fw fas fa-book"></i> <span>阅读</span></a></li><li><a class="site-page child" href="/games/"><i class="fa-fw fas fa-gamepad"></i> <span>游戏</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/messageaboard/"><i class="fa-fw fas fa-comment-dots"></i> <span>留言板</span></a></div><div class="menus_item"><a class="site-page" href="/artitalk/"><i class="fa-fw fas fa-cat"></i> <span>说说</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i> <span>友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-address-book"></i> <span>关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image:url(https://cdn.jsdelivr.net/gh/MCUheart/Hexo-blog-data@1.0.2/image/top/post-top/ros-top.jpg)"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">Malloy Yuan 的个人博客</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i> <span>搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i> <span>主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i> <span>时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i> <span>标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i> <span>分类</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);" rel="external nofollow noreferrer"><i class="fa-fw fas fa-list"></i> <span>娱乐</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i> <span>音乐</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-film"></i> <span>电影</span></a></li><li><a class="site-page child" href="/gallery/"><i class="fa-fw fas fa-camera-retro"></i> <span>照片</span></a></li><li><a class="site-page child" href="/books/"><i class="fa-fw fas fa-book"></i> <span>阅读</span></a></li><li><a class="site-page child" href="/games/"><i class="fa-fw fas fa-gamepad"></i> <span>游戏</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/messageaboard/"><i class="fa-fw fas fa-comment-dots"></i> <span>留言板</span></a></div><div class="menus_item"><a class="site-page" href="/artitalk/"><i class="fa-fw fas fa-cat"></i> <span>说说</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i> <span>友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-address-book"></i> <span>关于</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">ROS通信框架</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2020-05-18T08:26:40.000Z" title="发表于 2020-05-18 16:26:40">2020-05-18</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2022-02-10T03:46:06.118Z" title="更新于 2022-02-10 11:46:06">2022-02-10</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/ros/">ROS</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">8.9k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>30分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" data-flag-title="ROS通信框架"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span><span class="post-meta-separator">|</span><span class="post-meta-commentcount"><i class="far fa-comments fa-fw post-meta-icon"></i><span class="post-meta-label">评论数:</span><a href="/posts/8ae22c6d.html#post-comment"><span id="twikoo-count"></span></a></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><link rel="stylesheet external nofollow noreferrer" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><h1 id="1-node"><a class="markdownIt-Anchor" href="#1-node"></a> 1. Node</h1><p>在ROS的世界里，<strong>最小的进程单元</strong>就是节点（node）。一个软件包里可以有多个可执行文件，可执行文件在运行之后就成了一个进程(process)，这个进程在ROS中就叫做<strong>节点</strong>。 从程序角度来说，node就是一个可执行文件（通常为C++编译生成的可执行文件、Python脚本）被执行，加载到了内存之中；从功能角度来说，通常一个node负责者机器人的某一个单独的功能。由于机器人的功能模块非常复杂，我们往往不会把所有功能都集中到一个node上，而会采用分布式的方式，把鸡蛋放到不同的篮子里。例如有一个node来控制底盘轮子的运动，有一个node驱动摄像头获取图像，有一个node驱动激光雷达，有一个node根据传感器信息进行路径规划……<strong>这样做可以降低程序发生崩溃的可能性，试想一下如果把所有功能都写到一个程序中，模块间的通信、异常处理将会很麻烦。</strong></p><h1 id="2-master"><a class="markdownIt-Anchor" href="#2-master"></a> 2. Master</h1><p>由于机器人的元器件很多，功能庞大，因此实际运行时往往会运行众多的node，负责感知世界、控制运动、决策和计算等功能。那么如何合理的进行调配、管理这些node？这就要利用ROS提供给我们的节点管理器master, master在整个网络通信架构里相当于管理中心，管理着各个node。<strong>node首先在master处进行注册，之后master会将该node纳入整个ROS程序中。<strong>node之间的通信也是</strong>先由master进行“牵线”</strong>，才能两两的进行点对点通信。当ROS程序启动时，第一步首先启动master，由节点管理器处理依次启动node。</p><h1 id="3-启动master和node"><a class="markdownIt-Anchor" href="#3-启动master和node"></a> 3. 启动master和node</h1><p>当我们要启动ROS时，首先输入命令:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ roscore</span><br></pre></td></tr></table></figure><p>此时ROS master启动，同时启动的还有**<code>rosout</code><strong>和</strong><code>parameter server</code><strong>,其中<code>rosout</code>是</strong>负责日志输出的一个节点**，其作用是告知用户当前系统的状态，包括输出系统的error、warning等等，并且将log记录于日志文件中，<code>parameter server</code>即是<strong>参数服务器</strong>，它并不是一个node，<strong>而是存储参数配置的一个服务器</strong>，后文我们会单独介绍。每一次我们运行ROS的节点前，都需要把master启动起来，这样才能够让节点启动和注册。</p><p>master之后，节点管理器就开始按照系统的安排协调进行启动具体的节点。节点就是一个进程，只不过在ROS中它被赋予了专用的名字里——node。在第二章我们介绍了ROS的文件系统，我们知道一个package中存放着可执行文件，可执行文件是静态的，当系统执行这些可执行文件，将这些文件加载到内存中，它就成为了<strong>动态的node</strong>。具体启动node的语句是：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ rosrun pkg_name node_name</span><br></pre></td></tr></table></figure><p>通常我们运行ROS，就是按照这样的顺序启动，有时候节点太多，我们会选择用launch文件来启动，下一小节会有介绍。 Master、Node之间以及Node之间的关系如下图所示：</p><p><img src="/img/private/loading-4.gif" data-lazy-src="https://sychaichangkun.gitbooks.io/ros-tutorial-icourse163/content/pics/masterandnode.png" alt="img"></p><h1 id="4-rosrun和rosnode命令"><a class="markdownIt-Anchor" href="#4-rosrun和rosnode命令"></a> 4. rosrun和rosnode命令</h1><p><strong>rosrun命令的详细用法如下</strong>：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ rosrun [--prefix cmd] [--debug] pkg_name node_name [ARGS]</span><br></pre></td></tr></table></figure><p>rosrun将会寻找PACKAGE下的名为EXECUTABLE的可执行程序，将可选参数ARGS传入。 例如在GDB下运行ros程序：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ rosrun --prefix &#x27;gdb -ex run --args&#x27; pkg_name node_name</span><br></pre></td></tr></table></figure><p><strong>rosnode命令的详细作用列表如下</strong>：</p><table><thead><tr><th style="text-align:center">rosnode命令</th><th style="text-align:center">作用</th></tr></thead><tbody><tr><td style="text-align:center"><code>rosnode list</code></td><td style="text-align:center">列出当前运行的node信息</td></tr><tr><td style="text-align:center"><code>rosnode info node_name</code></td><td style="text-align:center">显示出node的详细信息</td></tr><tr><td style="text-align:center"><code>rosnode kill node_name</code></td><td style="text-align:center">结束某个node</td></tr><tr><td style="text-align:center"><code>rosnode ping</code></td><td style="text-align:center">测试连接节点</td></tr><tr><td style="text-align:center"><code>rosnode machine</code></td><td style="text-align:center">列出在特定机器或列表机器上运行的节点</td></tr><tr><td style="text-align:center"><code>rosnode cleanup</code></td><td style="text-align:center">清除不可到达节点的注册信息</td></tr></tbody></table><p>以上命令中常用的为前三个，在开发调试时经常会需要查看当前node以及node信息，所以请记住这些常用命令。如果你想不起来，也可以通过<code>rosnode help</code>来查看<code>rosnode</code>命令的用法。</p><h1 id="5-launch文件"><a class="markdownIt-Anchor" href="#5-launch文件"></a> 5. launch文件</h1><h2 id="51-简介"><a class="markdownIt-Anchor" href="#51-简介"></a> 5.1. 简介</h2><p>机器人是一个系统工程，通常一个机器人运行操作时要开启很多个node，对于一个复杂的机器人的启动操作应该怎么做呢？当然，我们并不需要每个节点依次进行rosrun，ROS为我们提供了一个命令能一次性启动master和多个node。该命令是：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ roslaunch pkg_name file_name.launch</span><br></pre></td></tr></table></figure><p><strong>roslaunch命令首先会自动进行检测系统的roscore有没有运行</strong>，也即是确认节点管理器是否在运行状态中，如果master没有启动，那么roslaunch就会首先启动master，然后再按照launch的规则执行。launch文件里已经配置好了启动的规则。 所以<code>roslaunch</code>就像是一个<strong>启动工具</strong>，能够一次性把多个节点按照我们预先的配置启动起来，减少我们在终端中一条条输入指令的麻烦。</p><h2 id="52-写法与格式"><a class="markdownIt-Anchor" href="#52-写法与格式"></a> 5.2. 写法与格式</h2><p>launch文件同样也遵循着xml格式规范，是一种标签文本，它的格式包括以下标签：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">launch</span>&gt;</span>    <span class="comment">&lt;!--根标签--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">node</span>&gt;</span>    <span class="comment">&lt;!--需要启动的node及其参数--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">include</span>&gt;</span>    <span class="comment">&lt;!--包含其他launch--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">machine</span>&gt;</span>    <span class="comment">&lt;!--指定运行的机器--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">env-loader</span>&gt;</span>    <span class="comment">&lt;!--设置环境变量--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">param</span>&gt;</span>    <span class="comment">&lt;!--定义参数到参数服务器--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">rosparam</span>&gt;</span>    <span class="comment">&lt;!--启动yaml文件参数到参数服务器--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">arg</span>&gt;</span>    <span class="comment">&lt;!--定义变量--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">remap</span>&gt;</span>    <span class="comment">&lt;!--设定参数映射--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">group</span>&gt;</span>    <span class="comment">&lt;!--设定命名空间--&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">launch</span>&gt;</span>    <span class="comment">&lt;!--根标签--&gt;</span></span><br></pre></td></tr></table></figure><p>参考链接:<a target="_blank" rel="noopener external nofollow noreferrer" href="http://wiki.ros.org/roslaunch/XML">http://wiki.ros.org/roslaunch/XML</a></p><h2 id="53-示例"><a class="markdownIt-Anchor" href="#53-示例"></a> 5.3. 示例</h2><p>launch文件的写法和格式看起来内容比较复杂，我们先来介绍一个最简单的例子如下：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">launch</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">node</span> <span class="attr">name</span>=<span class="string">&quot;talker&quot;</span> <span class="attr">pkg</span>=<span class="string">&quot;rospy_tutorials&quot;</span> <span class="attr">type</span>=<span class="string">&quot;talker&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">launch</span>&gt;</span></span><br></pre></td></tr></table></figure><p>这是官网给出的一个最小的例子，文本中的信息是，它启动了一个单独的节点<code>talker</code>,该节点是包<code>rospy_tutorials</code>软件包中的节点。</p><p>然而实际中的launch文件要复杂很多，我们以<code>Ros-Academy-for-Beginners</code>中的<code>robot_sim_demo</code>为例：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">launch</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--arg是launch标签中的变量声明，arg的name为变量名，default或者value为值--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">arg</span> <span class="attr">name</span>=<span class="string">&quot;robot&quot;</span> <span class="attr">default</span>=<span class="string">&quot;xbot2&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">arg</span> <span class="attr">name</span>=<span class="string">&quot;debug&quot;</span> <span class="attr">default</span>=<span class="string">&quot;false&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">arg</span> <span class="attr">name</span>=<span class="string">&quot;gui&quot;</span> <span class="attr">default</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">arg</span> <span class="attr">name</span>=<span class="string">&quot;headless&quot;</span> <span class="attr">default</span>=<span class="string">&quot;false&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- Start Gazebo with a blank world --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">include</span> <span class="attr">file</span>=<span class="string">&quot;$(find gazebo_ros)/launch/empty_world.launch&quot;</span>&gt;</span> <span class="comment">&lt;!--include用来嵌套仿真场景的launch文件--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">arg</span> <span class="attr">name</span>=<span class="string">&quot;world_name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$(find robot_sim_demo)/worlds/ROS-Academy.world&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">arg</span> <span class="attr">name</span>=<span class="string">&quot;debug&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$(arg debug)&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">arg</span> <span class="attr">name</span>=<span class="string">&quot;gui&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$(arg gui)&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">arg</span> <span class="attr">name</span>=<span class="string">&quot;paused&quot;</span> <span class="attr">value</span>=<span class="string">&quot;false&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">arg</span> <span class="attr">name</span>=<span class="string">&quot;use_sim_time&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">arg</span> <span class="attr">name</span>=<span class="string">&quot;headless&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$(arg headless)&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- Oh, you wanted a robot? --&gt;</span> <span class="comment">&lt;!--嵌套了机器人的launch文件--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">include</span> <span class="attr">file</span>=<span class="string">&quot;$(find robot_sim_demo)/launch/include/$(arg robot).launch.xml&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--如果你想连同RViz一起启动，可以按照以下方式加入RViz这个node--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--node name=&quot;rviz&quot; pkg=&quot;rviz&quot; type=&quot;rviz&quot; args=&quot;-d $(find robot_sim_demo)/urdf_gazebo.rviz&quot; /--&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">launch</span>&gt;</span></span><br></pre></td></tr></table></figure><p>这个launch文件相比上一个简单的例子来说，内容稍微有些复杂，它的作用是：启动gazebo模拟器，导入参数内容，加入机器人模型。</p><h2 id="54-小结"><a class="markdownIt-Anchor" href="#54-小结"></a> 5.4. 小结</h2><p>对于初学者，我们不要求掌握每一个标签是什么作用，但至少应该有一个印象。如果我们要进行自己写launch文件，可以先从改launch文件的模板入手，基本可以满足普通项目的要求。</p><h1 id="6-topic"><a class="markdownIt-Anchor" href="#6-topic"></a> 6. Topic</h1><h2 id="61-简介"><a class="markdownIt-Anchor" href="#61-简介"></a> 6.1. 简介</h2><p>ROS的通信方式是ROS最为核心的概念，ROS系统的精髓就在于它提供的通信架构。ROS的通信方式有以下四种：</p><ul><li>Topic 主题</li><li>Service 服务</li><li>Parameter Service 参数服务器</li><li>Actionlib 动作库</li></ul><h2 id="62-topic"><a class="markdownIt-Anchor" href="#62-topic"></a> 6.2. Topic</h2><p>ROS中的通信方式中，topic是常用的一种。对于<strong>实时性、周期性</strong>的消息，使用topic来传输是最佳的选择。topic是一种<strong>点对点的单向通信方式</strong>，这里的“点”指的是node，也就是说node之间可以通过topic方式来传递信息。topic要经历下面几步的初始化过程：首先，publisher节点和subscriber节点都要到节点管理器进行注册，然后publisher会发布topic，subscriber在master的指挥下会订阅该topic，从而建立起sub-pub之间的通信。**注意整个过程是单向的。**其结构示意图如下：</p><p><img src="/img/private/loading-4.gif" data-lazy-src="https://sychaichangkun.gitbooks.io/ros-tutorial-icourse163/content/pics/topic-stru.jpg" alt="img"></p><p>Subscriber接收消息会进行处理，一般这个过程叫做<strong>回调(Callback)</strong>。所谓回调就是<strong>提前定义好了一个处理函数（写在代码中），当有消息来就会触发这个处理函数，函数会对消息进行处理。</strong></p><p>上图就是ROS的topic通信方式的流程示意图。topic通信属于一种异步的通信方式。下面我们通过一个示例来了解下如何使用topic通信。</p><h2 id="63-通信示例"><a class="markdownIt-Anchor" href="#63-通信示例"></a> 6.3. 通信示例</h2><p>参考下图，我们以摄像头画面的发布、处理、显示为例讲讲topic通信的流程。在机器人上的摄像头拍摄程序是一个node（圆圈表示,我们记作node1），当node1运行启动之后，它作为一个Publisher就开始发布topic。比如它发布了一个topic（方框表示），叫做<code>/camera_rgb</code>，是rgb颜色信息，即采集到的彩色图像。同时，node2假如是图像处理程序,它订阅了<code>/camera_rgb</code>这个topic，经过节点管理器的介绍，它就能建立和摄像头节点（node1）的连接。</p><p>那么怎么样来理解**“异步”**这个概念呢？在node1每发布一次消息之后，就会继续执行下一个动作，至于消息是什么状态、被怎样处理，它不需要了解；而对于node2图像处理程序，它只管接收和处理<code>/camera_rgb</code>上的消息，至于是谁发来的，它不会关心。所以node1、node2两者都是各司其责，<strong>不存在协同工作</strong>，我们称这样的通信方式是异步的。</p><p><img src="/img/private/loading-4.gif" data-lazy-src="https://sychaichangkun.gitbooks.io/ros-tutorial-icourse163/content/pics/ex-camera.jpg" alt="img"></p><p>ROS是一种分布式的架构，**一个topic可以被多个节点同时发布，也可以同时被多个节点接收。**比如在这个场景中用户可以再加入一个图像显示的节点，我们在想看看摄像头节点的画面，则可以用自己的笔记本连接到机器人上的节点管理器，然后在自己的电脑上启动图像显示节点。</p><p>这就体现了分布式系统通信的好处：扩展性好、软件复用率高。</p><p><strong>总结三点</strong>：</p><ol><li>topic通信方式是异步的，<strong>发送时调用publish()方法，发送完成立即返回，不用等待反馈。</strong></li><li>subscriber通过回调函数的方式来处理消息。</li><li>topic可以同时有多个subscribers，也可以同时有多个publishers。ROS中这样的例子有：/rosout、/tf等等。</li></ol><h2 id="64-操作命令"><a class="markdownIt-Anchor" href="#64-操作命令"></a> 6.4. 操作命令</h2><p>在实际应用中，我们应该熟悉topic的几种使用命令，下表详细的列出了各自的命令及其作用。</p><table><thead><tr><th style="text-align:center">命令</th><th style="text-align:center">作用</th></tr></thead><tbody><tr><td style="text-align:center"><code>rostopic list</code></td><td style="text-align:center">列出当前所有的topic</td></tr><tr><td style="text-align:center"><code>rostopic info topic_name</code></td><td style="text-align:center">显示某个topic的属性信息</td></tr><tr><td style="text-align:center"><code>rostopic echo topic_name</code></td><td style="text-align:center">显示某个topic的内容</td></tr><tr><td style="text-align:center"><code>rostopic pub topic_name ...</code></td><td style="text-align:center">向某个topic发布内容</td></tr><tr><td style="text-align:center"><code>rostopic bw topic_name</code></td><td style="text-align:center">查看某个topic的带宽</td></tr><tr><td style="text-align:center"><code>rostopic hz topic_name</code></td><td style="text-align:center">查看某个topic的频率</td></tr><tr><td style="text-align:center"><code>rostopic find topic_type</code></td><td style="text-align:center">查找某个类型的topic</td></tr><tr><td style="text-align:center"><code>rostopic type topic_name</code></td><td style="text-align:center">查看某个topic的类型(msg)</td></tr></tbody></table><p>如果你一时忘记了命令的写法，可以通过<code>rostopic help</code>或<code>rostopic command -h</code>查看具体用法。</p><h2 id="65-测试实例"><a class="markdownIt-Anchor" href="#65-测试实例"></a> 6.5. 测试实例</h2><ol><li>首先打开<code>ROS-Academy-for-Beginners</code>的模拟场景，输入<code>roslaunch robot_sim_demo robot_spawn_launch</code>,看到我们仿真的模拟环境。该<code>launch</code>文件启动了模拟场景、机器人。</li><li>查看当前模拟器中存在的topic，输入命令<code>rostopic list</code>。可以看到许多topic，它们可以视为模拟器与外界交互的接口。</li><li>查询topic<code>/camera/rgb/image_raw</code>的相关信息：<code>rostopic info /camera/rgb/image_raw</code>。则会显示类型信息type，发布者和订阅者的信息。</li><li>上步我们在演示中可以得知，并没有订阅者订阅该主题，我们指定<code>image_view</code>来接收这个消息，运行命令<code>rosrun image_view image_view image:= [transport]</code>。我们可以看到message，即是上一步中的type。</li><li>同理我们可以查询摄像头的深度信息depth图像。</li><li>在用键盘控制仿真机器人运动的时候，我们可以查看速度指令topic的内容<code>rostopic echo /cmd_vel</code> ，可以看到窗口显示的各种坐标参数在不断的变化。</li></ol><p>通过这些实例的测试，帮助我们更快的掌握topic各种操作命令的使用，以及对topic通信的理解。</p><h2 id="66-小结"><a class="markdownIt-Anchor" href="#66-小结"></a> 6.6. 小结</h2><p>topic的通信方式是ROS中比较常见的单向异步通信方式，它在很多时候的通信是比较易用且高效的。但是有些需要交互的通信时该方式就显露出自己的不足之处了，后续我们会介绍双向同步的通信方式service。</p><h1 id="7-message"><a class="markdownIt-Anchor" href="#7-message"></a> 7. Message</h1><h2 id="71-简介"><a class="markdownIt-Anchor" href="#71-简介"></a> 7.1. 简介</h2><p>topic有很严格的格式要求，比如上节的摄像头进程中的rgb图像topic，它就必然要遵循ROS中定义好的rgb图像格式。这种数据格式就是Message。**Message按照定义解释就是topic内容的数据类型，也称之为topic的格式标准。**这里和我们平常用到的Massage直观概念有所不同，这里的Message不单单指一条发布或者订阅的消息，也指定为topic的格式标准。</p><h2 id="72-结构与类型"><a class="markdownIt-Anchor" href="#72-结构与类型"></a> 7.2. 结构与类型</h2><p>基本的msg包括**bool、int8、int16、int32、int64(以及uint)、float、float64、string、time、duration、header、可变长数组array[]、固定长度数组array[C]。**那么具体的一个msg是怎么组成的呢？我们用一个具体的msg来了解，例如上例中的msg <code>sensor_msg/image</code>,位置存放在<code>sensor_msgs/msg/image.msg</code>里,它的结构如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">std_msg/Header header</span><br><span class="line">    uint32    seq</span><br><span class="line">    time    stamp</span><br><span class="line">    string    frame_id</span><br><span class="line">uint32    height</span><br><span class="line">uint32    width</span><br><span class="line">string    encoding</span><br><span class="line">uint8    is_bigendian</span><br><span class="line">uint32    step</span><br><span class="line">uint8[]    data</span><br></pre></td></tr></table></figure><p>观察上面msg的定义，**是不是很类似C语言中的结构体呢？**通过具体的定义图像的宽度，高度等等来规范图像的格式。所以这就解释了Message不仅仅是我们平时理解的一条一条的消息，而且更是ROS中topic的格式规范。或者可以理解msg是一个“类”，那么我们每次发布的内容可以理解为“对象”，这么对比来理解可能更加容易。 我们实际通常不会把Message概念分的那么清，**通常说Message既指的是类，也是指它的对象。**而msg文件则相当于类的定义了。</p><h2 id="73-操作命令"><a class="markdownIt-Anchor" href="#73-操作命令"></a> 7.3. 操作命令</h2><p>rosmsg的命令相比topic就比较少了，只有两个如下：</p><table><thead><tr><th style="text-align:center">rosmsg命令</th><th style="text-align:center">作用</th></tr></thead><tbody><tr><td style="text-align:center"><code>rosmsg list</code></td><td style="text-align:center">列出系统上所有的msg</td></tr><tr><td style="text-align:center"><code>rosmsg show msg_name</code></td><td style="text-align:center">显示某个msg的内容</td></tr></tbody></table><h2 id="74-常见message"><a class="markdownIt-Anchor" href="#74-常见message"></a> 7.4. 常见message</h2><p>我们看看常见的message类型，包括std_msgs, sensor_msgs, nav_msgs, geometry_msgs等</p><p><strong>Vector3.msg</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#文件位置:geometry_msgs/Vector3.msg</span><br><span class="line"></span><br><span class="line">float64 x</span><br><span class="line">float64 y</span><br><span class="line">float64 z</span><br></pre></td></tr></table></figure><p><strong>Accel.msg</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#定义加速度项，包括线性加速度和角加速度</span><br><span class="line">#文件位置:geometry_msgs/Accel.msg</span><br><span class="line">Vector3 linear</span><br><span class="line">Vector3 angular</span><br></pre></td></tr></table></figure><p><strong>Header.msg</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#定义数据的参考时间和参考坐标</span><br><span class="line">#文件位置:std_msgs/Header.msg</span><br><span class="line">uint32 seq      #数据ID</span><br><span class="line">time stamp      #数据时间戳</span><br><span class="line">string frame_id #数据的参考坐标系</span><br></pre></td></tr></table></figure><p><strong>Echos.msg</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">#定义超声传感器</span><br><span class="line">#文件位置:自定义msg文件</span><br><span class="line">Header header</span><br><span class="line">uint16 front_left</span><br><span class="line">uint16 front_center</span><br><span class="line">uint16 front_right</span><br><span class="line">uint16 rear_left</span><br><span class="line">uint16 rear_center</span><br><span class="line">uint16 rear_right</span><br></pre></td></tr></table></figure><p><strong>Quaternion.msg</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">#消息代表空间中旋转的四元数</span><br><span class="line">#文件位置:geometry_msgs/Quaternion.msg</span><br><span class="line"></span><br><span class="line">float64 x</span><br><span class="line">float64 y</span><br><span class="line">float64 z</span><br><span class="line">float64 w</span><br></pre></td></tr></table></figure><p><strong>Imu.msg</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">#消息包含了从惯性原件中得到的数据，加速度为m/^2，角速度为rad/s</span><br><span class="line">#如果所有的测量协方差已知，则需要全部填充进来如果只知道方差，则</span><br><span class="line">#只填充协方差矩阵的对角数据即可</span><br><span class="line">#位置：sensor_msgs/Imu.msg</span><br><span class="line"></span><br><span class="line">Header header</span><br><span class="line">Quaternion orientation</span><br><span class="line">float64[9] orientation_covariance</span><br><span class="line">Vector3 angular_velocity</span><br><span class="line">float64[9] angular_velocity_covariance</span><br><span class="line">Vector3 linear_acceleration</span><br><span class="line">float64[] linear_acceleration_covariance</span><br></pre></td></tr></table></figure><p><strong>LaserScan.msg</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">#平面内的激光测距扫描数据，注意此消息类型仅仅适配激光测距设备</span><br><span class="line">#如果有其他类型的测距设备(如声呐)，需要另外创建不同类型的消息</span><br><span class="line">#位置：sensor_msgs/LaserScan.msg</span><br><span class="line"></span><br><span class="line">Header header            #时间戳为接收到第一束激光的时间</span><br><span class="line">float32 angle_min        #扫描开始时的角度(单位为rad)</span><br><span class="line">float32 angle_max        #扫描结束时的角度(单位为rad)</span><br><span class="line">float32 angle_increment    #两次测量之间的角度增量(单位为rad)</span><br><span class="line">float32 time_increment    #两次测量之间的时间增量(单位为s)</span><br><span class="line">float32 scan_time        #两次扫描之间的时间间隔(单位为s)</span><br><span class="line">float32 range_min        #距离最小值(m)</span><br><span class="line">float32 range_max        #距离最大值(m)</span><br><span class="line">float32[] ranges        #测距数据(m,如果数据不在最小数据和最大数据之间，则抛弃)</span><br><span class="line">float32[] intensities    #强度，具体单位由测量设备确定，如果仪器没有强度测量，则数组为空即可</span><br></pre></td></tr></table></figure><p><strong>Point.msg</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">#空间中的点的位置</span><br><span class="line">#文件位置:geometry_msgs/Point.msg</span><br><span class="line"></span><br><span class="line">float64 x</span><br><span class="line">float64 y</span><br><span class="line">float64 z</span><br></pre></td></tr></table></figure><p><strong>Pose.msg</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#消息定义自由空间中的位姿信息，包括位置和指向信息</span><br><span class="line">#文件位置:geometry_msgs/Pose.msg</span><br><span class="line"></span><br><span class="line">Point position</span><br><span class="line">Quaternion orientation</span><br></pre></td></tr></table></figure><p><strong>PoseStamped.msg</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#定义有时空基准的位姿</span><br><span class="line">#文件位置：geometry_msgs/PoseStamped.msg</span><br><span class="line"></span><br><span class="line">Header header</span><br><span class="line">Pose pose</span><br></pre></td></tr></table></figure><p><strong>PoseWithCovariance.msg</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#表示空间中含有不确定性的位姿信息</span><br><span class="line">#文件位置：geometry_msgs/PoseWithCovariance.msg</span><br><span class="line"></span><br><span class="line">Pose pose</span><br><span class="line">float64[36] covariance</span><br></pre></td></tr></table></figure><p><strong>Power.msg</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">#表示电源状态，是否开启</span><br><span class="line">#文件位置：自定义msg文件</span><br><span class="line">Header header</span><br><span class="line">bool power</span><br><span class="line">######################</span><br><span class="line">bool ON  = 1</span><br><span class="line">bool OFF = 0</span><br></pre></td></tr></table></figure><p><strong>Twist.msg</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#定义空间中物体运动的线速度和角速度</span><br><span class="line">#文件位置：geometry_msgs/Twist.msg</span><br><span class="line"></span><br><span class="line">Vector3 linear</span><br><span class="line">Vector3 angular</span><br></pre></td></tr></table></figure><p><strong>TwistWithCovariance.msg</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">#消息定义了包含不确定性的速度量，协方差矩阵按行分别表示：</span><br><span class="line">#沿x方向速度的不确定性，沿y方向速度的不确定性，沿z方向速度的不确定性</span><br><span class="line">#绕x转动角速度的不确定性，绕y轴转动的角速度的不确定性，绕z轴转动的</span><br><span class="line">#角速度的不确定性</span><br><span class="line">#文件位置：geometry_msgs/TwistWithCovariance.msg</span><br><span class="line"></span><br><span class="line">Twist twist</span><br><span class="line">float64[36] covariance  #分别表示[x; y; z; Rx; Ry; Rz]</span><br></pre></td></tr></table></figure><p><strong>Odometry.msg</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">#消息描述了自由空间中位置和速度的估计值</span><br><span class="line">#文件位置：nav_msgs/Odometry.msg</span><br><span class="line"></span><br><span class="line">Header header</span><br><span class="line">string child_frame_id</span><br><span class="line">PoseWithCovariance pose</span><br><span class="line">TwistWithCovariance twist</span><br></pre></td></tr></table></figure><h1 id="8-service"><a class="markdownIt-Anchor" href="#8-service"></a> 8. Service</h1><h2 id="81-service"><a class="markdownIt-Anchor" href="#81-service"></a> 8.1. Service</h2><p>我们介绍了ROS的通信方式中的topic(主题)通信，我们知道topic是ROS中的一种单向的异步通信方式。然而有些时候单向的通信满足不了通信要求，比如<strong>当一些节点只是临时而非周期性的需要某些数据</strong>，如果用topic通信方式时就会消耗大量不必要的系统资源，造成系统的低效率高功耗。<br>这种情况下，**就需要有另外一种请求-查询式的通信模型。**这节我们来介绍ROS通信中的另一种通信方式——service(服务)。</p><h2 id="82-工作原理"><a class="markdownIt-Anchor" href="#82-工作原理"></a> 8.2. 工作原理</h2><h3 id="821-简介"><a class="markdownIt-Anchor" href="#821-简介"></a> 8.2.1. 简介</h3><p>为了解决以上问题，service方式在通信模型上与topic做了区别。<strong>Service通信是双向的，它不仅可以发送消息，同时还会有反馈。<strong>所以service包括两部分，一部分是请求方（Clinet），另一部分是应答方/服务提供方（Server）。这时请求方（Client）就会发送一个request，要等待server处理，反馈回一个reply，这</strong>样通过类似“请求-应答”的机制完成整个服务通信。</strong></p><p>这种通信方式的示意图如下：<br>Node B是server（应答方），提供了一个服务的接口，叫做<code>/Service</code>，我们一般都会用string类型来指定service的名称，类似于topic。Node A向Node B发起了请求，经过处理后得到了反馈。<br><img src="/img/private/loading-4.gif" data-lazy-src="https://sychaichangkun.gitbooks.io/ros-tutorial-icourse163/content/pics/service_structure.png" alt="img"></p><h3 id="822-过程"><a class="markdownIt-Anchor" href="#822-过程"></a> 8.2.2. 过程</h3><p>Service是同步通信方式，所谓同步就是说，此时Node A发布请求后会在原地等待reply，直到Node B处理完了请求并且完成了reply，Node A才会继续执行。**Node A等待过程中，是处于阻塞状态的成通信。**这样的通信模型没有频繁的消息传递，<strong>没有冲突与高系统资源的占用，只有接受请求才执行服务，简单而且高效。</strong></p><h2 id="83-topic-vs-service"><a class="markdownIt-Anchor" href="#83-topic-vs-service"></a> 8.3. topic VS service</h2><p>我们对比一下这两种最常用的通信方式，加深我们对两者的理解和认识，具体见下表：</p><table><thead><tr><th style="text-align:center">名称</th><th style="text-align:center">Topic</th><th style="text-align:center">Service</th></tr></thead><tbody><tr><td style="text-align:center">通信方式</td><td style="text-align:center">异步通信</td><td style="text-align:center">同步通信</td></tr><tr><td style="text-align:center">实现原理</td><td style="text-align:center">TCP/IP</td><td style="text-align:center">TCP/IP</td></tr><tr><td style="text-align:center">通信模型</td><td style="text-align:center">Publish-Subscribe</td><td style="text-align:center">Request-Reply</td></tr><tr><td style="text-align:center">映射关系</td><td style="text-align:center">Publish-Subscribe(多对多)</td><td style="text-align:center">Request-Reply（多对一）</td></tr><tr><td style="text-align:center">特点</td><td style="text-align:center">接受者收到数据会回调（Callback）</td><td style="text-align:center">远程过程调用（RPC）服务器端的服务</td></tr><tr><td style="text-align:center">应用场景</td><td style="text-align:center">连续、高频的数据发布</td><td style="text-align:center">偶尔使用的功能/具体的任务</td></tr><tr><td style="text-align:center">举例</td><td style="text-align:center">激光雷达、里程计发布数据</td><td style="text-align:center">开关传感器、拍照、逆解计算</td></tr></tbody></table><p>**注意：**远程过程调用(Remote Procedure Call，RPC),可以简单通俗的理解为在一个进程里调用另一个进程的函数。</p><h2 id="84-操作命令"><a class="markdownIt-Anchor" href="#84-操作命令"></a> 8.4. 操作命令</h2><p>在实际应用中，service通信方式的命令<code>rosservice</code>，具体的命令参数如下表：</p><table><thead><tr><th style="text-align:center">rosservice 命令</th><th style="text-align:center">作用</th></tr></thead><tbody><tr><td style="text-align:center"><code>rosservice list</code></td><td style="text-align:center">显示服务列表</td></tr><tr><td style="text-align:center"><code>rosservice info</code></td><td style="text-align:center">打印服务信息</td></tr><tr><td style="text-align:center"><code>rosservice type</code></td><td style="text-align:center">打印服务类型</td></tr><tr><td style="text-align:center"><code>rosservice uri</code></td><td style="text-align:center">打印服务ROSRPC uri</td></tr><tr><td style="text-align:center"><code>rosservice find</code></td><td style="text-align:center">按服务类型查找服务</td></tr><tr><td style="text-align:center"><code>rosservice call</code></td><td style="text-align:center">使用所提供的args调用服务</td></tr><tr><td style="text-align:center"><code>rosservice args</code></td><td style="text-align:center">打印服务参数</td></tr></tbody></table><h2 id="85-测试实例"><a class="markdownIt-Anchor" href="#85-测试实例"></a> 8.5. 测试实例</h2><ol><li>首先依然是打开我们教材的模拟场景<code>roslaunch robot_sim_demo robot_spawn.launch</code>。</li><li>输入<code>rosservice list</code>，查看当前运行的服务。</li><li>随机选择<code>/gazebo/delete_light</code>服务，观察名称，是删除光源的操作。</li><li>输入<code>rosservice info /gazebo/delete_light</code>查看属性信息。可以看到信息，Node：/gazebo，Type：gazebo_msgs/DeleteLight, Args：Light_name。这里的类型type也就是下文介绍的srv,传递参数Light_name</li><li>输入<code>rosservice call /gazebo/delete_light sun</code>,这里的sun 是参数名，使我们模拟场景中的唯一光源太阳。操作完成后可以看到场景中的光线消失。</li><li>可以看到终端的回传信息：success: True和sun successfully deleted。这就是双向通信的信息反馈，通知操作已经成功完成。</li></ol><h2 id="86-小结"><a class="markdownIt-Anchor" href="#86-小结"></a> 8.6. 小结</h2><p>本节我们详细介绍了service通信方式，建议与topic通信方式进行对比记忆，这样我们能更深的理解这两种通信方式，也能在以后的学习工作中更加合理使用每个通信方式，获得更高的效率。</p><h1 id="9-srv"><a class="markdownIt-Anchor" href="#9-srv"></a> 9. Srv</h1><h2 id="91-简介"><a class="markdownIt-Anchor" href="#91-简介"></a> 9.1. 简介</h2><p>类似msg文件，srv文件是用来描述service服务的文件 (service的数据类型，service通信的数据格式定义在*.srv中) 它声明了一个服务，包括请求 (<strong>request</strong>) 和响应 (<strong>reply</strong>) 两部分。其格式声明如下：</p><p><strong>举例：</strong></p><p>msgs_demo/srv/DetectHuman.srv</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">bool start_detect</span><br><span class="line">---</span><br><span class="line">my_pkg/HumanPose[] pose_data</span><br></pre></td></tr></table></figure><p>msgs_demo/msg/HumanPose.msg</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">std_msgs/Header header</span><br><span class="line">string uuid</span><br><span class="line">int32 number_of_joints</span><br><span class="line">my_pkg/JointPose[]joint_data</span><br></pre></td></tr></table></figure><p>msgs_demo/msg/JointPose.msg</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">string joint_name</span><br><span class="line">geometry_msgs/Pose pose</span><br><span class="line">floar32 confidence</span><br></pre></td></tr></table></figure><p>以<code>DetectHUman.srv</code>文件为例，该服务例子取自OpenNI的人体检测ROS软件包。它是用来查询当前深度摄像头中的人体姿态和关节数的。srv文件格式很固定，<strong>第一行是请求的格式</strong>，中间用**—**隔开，<strong>第三行是应答的格式</strong>。在本例中，请求为是否开始检测，应答为一个数组，数组的每个元素为某个人的姿态（HumanPose）。而对于人的姿态，其实是一个msg，<strong>所以srv可以嵌套msg在其中，但它不能嵌套srv。</strong></p><h2 id="92-操作命令"><a class="markdownIt-Anchor" href="#92-操作命令"></a> 9.2. 操作命令</h2><p>具体的操作指令如下表：</p><table><thead><tr><th style="text-align:center">rossrv 命令</th><th style="text-align:center">作用</th></tr></thead><tbody><tr><td style="text-align:center"><code>rossrv show</code></td><td style="text-align:center">显示服务描述</td></tr><tr><td style="text-align:center"><code>rossrv list</code></td><td style="text-align:center">列出所有服务</td></tr><tr><td style="text-align:center"><code>rossrv md5</code></td><td style="text-align:center">显示服务md5sum</td></tr><tr><td style="text-align:center"><code>rossrv package</code></td><td style="text-align:center">列出包中的服务</td></tr><tr><td style="text-align:center"><code>rossrv packages</code></td><td style="text-align:center">列出包含服务的包</td></tr></tbody></table><h2 id="93-修改部分文件"><a class="markdownIt-Anchor" href="#93-修改部分文件"></a> 9.3. 修改部分文件</h2><p>定义完了msg、srv文件，还有重要的一个步骤就是修改package.xml和修改CMakeList.txt。这些文件需要添加一些必要的依赖等，例如：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;build_depend&gt;** message_generation **&lt;/build_depend&gt;</span><br><span class="line">&lt;run_depend&gt;** message_runtime **&lt;/run_depend&gt;</span><br></pre></td></tr></table></figure><p>上述文本中“**”所引就是新添加的依赖。又例如：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">find_package(...roscpp rospy std_msgs ** message_generation **)</span><br><span class="line">catkin_package(</span><br><span class="line">...</span><br><span class="line">CATJIN_DEPENDS ** message_runtime ** ...</span><br><span class="line">...)</span><br><span class="line"></span><br><span class="line">add_message_file(</span><br><span class="line">FILES</span><br><span class="line">** DetectHuman.srv **</span><br><span class="line">** HumanPose.msg **</span><br><span class="line">** JointPos.msg **)</span><br><span class="line"></span><br><span class="line">** generate_messages(DEPENDENCIES std_msgs) **</span><br></pre></td></tr></table></figure><p>**添加的这些内容指定了srv或者msg在编译或者运行中需要的依赖。**具体的作用我们初学者可不深究，我们需要了解的是，<strong>无论我们自定义了srv,还是msg，修改上述部分添加依赖都是必不可少的一步。</strong></p><h1 id="10-parameter-server"><a class="markdownIt-Anchor" href="#10-parameter-server"></a> 10. Parameter server</h1><h2 id="101-简介"><a class="markdownIt-Anchor" href="#101-简介"></a> 10.1. 简介</h2><p>前文介绍了ROS中常见的两种通信方式——主题和服务，这节介绍另外一种通信方式——参数服务器（parameter server）。与前两种通信方式不同，参数服务器也可以说是特殊的“通信方式”。<strong>特殊点在于参数服务器是节点存储参数的地方、用于配置参数，全局共享参数。参数服务器使用互联网传输，在节点管理器中运行，实现整个通信过程。</strong></p><p>参数服务器，作为ROS中另外一种数据传输方式，有别于topic和service，<strong>它更加的静态。<strong>参数服务器维护着一个</strong>数据字典，字典里存储着各种参数和配置。</strong></p><h3 id="1011-字典简介"><a class="markdownIt-Anchor" href="#1011-字典简介"></a> 10.1.1. 字典简介</h3><p>何为字典，其实就是<strong>一个个的键值对</strong>，我们小时候学习语文的时候，常常都会有一本字典，当遇到不认识的字了我们可以查部首查到这个字，获取这个字的读音、意义等等，而这里的字典可以对比理解记忆。键值kay可以理解为语文里的“部首”这个概念，每一个key都是唯一的，参照下图：</p><p><img src="/img/private/loading-4.gif" data-lazy-src="https://sychaichangkun.gitbooks.io/ros-tutorial-icourse163/content/pics/dictionaries%20_kay.png" alt="img"></p><p>每一个key不重复，且每一个key对应着一个value。<strong>也可以说字典就是一种映射关系</strong>，在实际的项目应用中，<strong>因为字典的这种静态的映射特点，我们往往将一些不常用到的参数和配置放入参数服务器里的字典里，这样对这些数据进行读写都将方便高效。</strong></p><h3 id="1012-维护方式"><a class="markdownIt-Anchor" href="#1012-维护方式"></a> 10.1.2. 维护方式</h3><p>参数服务器的维护方式非常的简单灵活，总的来讲有<strong>三种方式</strong>：</p><ul><li>命令行维护</li><li>launch文件内读写</li><li>node源码</li></ul><p>下面我们来一一介绍这三种维护方式。</p><h2 id="102-命令行维护"><a class="markdownIt-Anchor" href="#102-命令行维护"></a> 10.2. 命令行维护</h2><p>使用命令行来维护参数服务器，主要使用<code>rosparam</code>语句来进行操作的各种命令，如下表：</p><table><thead><tr><th style="text-align:center">rosparam 命令</th><th style="text-align:center">作用</th></tr></thead><tbody><tr><td style="text-align:center"><code>rosparam set param_key param_value</code></td><td style="text-align:center">设置参数</td></tr><tr><td style="text-align:center"><code>rosparam get param_key</code></td><td style="text-align:center">显示参数</td></tr><tr><td style="text-align:center"><code>rosparam load file_name</code></td><td style="text-align:center">从文件加载参数</td></tr><tr><td style="text-align:center"><code>rosparam dump file_name</code></td><td style="text-align:center">保存参数到文件</td></tr><tr><td style="text-align:center"><code>rosparam delete</code></td><td style="text-align:center">删除参数</td></tr><tr><td style="text-align:center"><code>rosparam list</code></td><td style="text-align:center">列出参数名称</td></tr></tbody></table><h3 id="1021-loaddump文件"><a class="markdownIt-Anchor" href="#1021-loaddump文件"></a> 10.2.1. load&amp;&amp;dump文件</h3><p>load和dump文件需要遵守YAML格式，YAML格式具体示例如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">name:&#x27;Zhangsan&#x27;</span><br><span class="line">age:20</span><br><span class="line">gender:&#x27;M&#x27;</span><br><span class="line">score&#123;Chinese:80,Math:90&#125;</span><br><span class="line">score_history:[85,82,88,90]</span><br></pre></td></tr></table></figure><p>简明解释。就是“名称+：+值”这样一种常用的解释方式。一般格式如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">key : value</span><br></pre></td></tr></table></figure><p>遵循格式进行定义参数。其实就可以把YAML文件的内容理解为字典，因为它也是键值对的形式。</p><h2 id="103-launch文件内读写"><a class="markdownIt-Anchor" href="#103-launch文件内读写"></a> 10.3. launch文件内读写</h2><p>launch文件中有很多标签，而与参数服务器相关的标签只有两个，一个是<code>，另一个是</code>。这两个标签功能比较相近，但``一般只设置一个参数，请看下例：</p><p>（1） （2） （3）</p><p>观察上例比如序号3的param就定义了一个key和一个value，交给了参数服务器维护。而序号1的param只给出了key，没有直接给出value，这里的value是由后没的脚本运行结果作为value进行定义的。序号(2)就是rosparam的典型用法，先指定一个YAML文件，然后施加command,其效果等于<code>rosparam load file_name</code> 。</p><h2 id="104-node源码"><a class="markdownIt-Anchor" href="#104-node源码"></a> 10.4. node源码</h2><p>除了上述最常用的两种读写参数服务器的方法，还有一种就是修改ROS的源码，也就是利用API来对参数服务器进行操作。具体内容我们学习完后面章节再进行介绍。</p><h2 id="105-操作实例"><a class="markdownIt-Anchor" href="#105-操作实例"></a> 10.5. 操作实例</h2><ol><li>首先依然是打开我们教材的模拟场景<code>roslaunch robot_sim_demo robot_spawn.launch</code>。</li><li>输入<code>rosparam list</code>查看参数服务器上的param。</li><li>查询参数信息，例如查询竖直方向重力参数。输入<code>rosparam get /gazebo/gravity_z</code>回车得到参数值value=-9.8。</li><li>尝试保存一个参数到文件输入<code>rosparam dump param.yaml</code>之后就可以在当前路径看到该文件，也就能打开去查看到相关的参数信息。</li><li>参数服务器的其他命令操作方式大致相同，我们可以多多练习，巩固对参数服务器的理解和应用。</li></ol><h2 id="106-参数类型"><a class="markdownIt-Anchor" href="#106-参数类型"></a> 10.6. 参数类型</h2><p>ROS参数服务器为参数值使用XMLRPC数据类型，其中包括:strings, integers, floats, booleans, lists, dictionaries, iso8601 dates, and base64-encoded data。</p><h1 id="11-action"><a class="markdownIt-Anchor" href="#11-action"></a> 11. Action</h1><h2 id="111-简介"><a class="markdownIt-Anchor" href="#111-简介"></a> 11.1. 简介</h2><p>Actionlib是ROS中一个很重要的库，**类似service通信机制，actionlib也是一种请求响应机制的通信方式，**actionlib主要弥补了service通信的一个不足，就是当机器人执行一个长时间的任务时，假如利用service通信方式，那么publisher会很长时间接受不到反馈的reply，致使通信受阻。当service通信不能很好的完成任务时候，<strong>actionlib则可以比较适合实现长时间的通信过程，actionlib通信过程可以随时被查看过程进度，也可以终止请求，这样的一个特性，使得它在一些特别的机制中拥有很高的效率。</strong></p><h1 id="12-通信原理"><a class="markdownIt-Anchor" href="#12-通信原理"></a> 12. 通信原理</h1><blockquote><p>Action的工作原理是client-server模式，也是一个<strong>双向的通信模式</strong>。通信双方在<strong>ROS Action Protocol</strong>下通过消息进行数据的交流通信。<strong>client和server为用户提供一个简单的API来请求目标（在客户端）或通过函数调用和回调来执行目标（在服务器端）。</strong></p></blockquote><p>工作模式的结构示意图如下：</p><p><img src="/img/private/loading-4.gif" data-lazy-src="https://sychaichangkun.gitbooks.io/ros-tutorial-icourse163/content/pics/actionlib.png" alt="img"></p><p>通信双方在ROS Action Protocal下进行交流通信是通过接口来实现,如下图:</p><p><img src="/img/private/loading-4.gif" data-lazy-src="https://sychaichangkun.gitbooks.io/ros-tutorial-icourse163/content/pics/action_interface.png" alt="img"></p><p><strong>我们可以看到,客户端会向服务器发送目标指令和取消动作指令,而服务器则可以给客户端发送实时的状态信息,结果信息,反馈信息等等,从而完成了service没法做到的部分.</strong></p><h2 id="121-action-规范"><a class="markdownIt-Anchor" href="#121-action-规范"></a> 12.1. Action 规范</h2><p>利用动作库进行请求响应，动作的内容格式应包含三个部分，目标、反馈、结果。</p><ul><li>目标</li></ul><p>机器人执行一个动作，应该有明确的移动目标信息，包括一些参数的设定，方向、角度、速度等等。从而使机器人完成动作任务。</p><ul><li>反馈</li></ul><p>在动作进行的过程中，应该有实时的状态信息反馈给服务器的实施者，告诉实施者动作完成的状态，可以使实施者作出准确的判断去修正命令。</p><ul><li>结果</li></ul><p>当运动完成时，动作服务器把本次运动的结果数据发送给客户端，使客户端得到本次动作的全部信息，例如可能包含机器人的运动时长，最终姿势等等。</p><h2 id="122-action规范文件格式"><a class="markdownIt-Anchor" href="#122-action规范文件格式"></a> 12.2. Action规范文件格式</h2><p>Action规范文件的后缀名是.action，它的内容格式如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># Define the goal</span><br><span class="line">uint32 dishwasher_id  # Specify which dishwasher we want to use</span><br><span class="line">---</span><br><span class="line"># Define the result</span><br><span class="line">uint32 total_dishes_cleaned</span><br><span class="line">---</span><br><span class="line"># Define a feedback message</span><br><span class="line">float32 percent_complete</span><br></pre></td></tr></table></figure><h2 id="123-action实例详解"><a class="markdownIt-Anchor" href="#123-action实例详解"></a> 12.3. Action实例详解</h2><p>Actionlib是一个用来实现action的一个功能包集。我们在demo中设置一个场景，执行一个搬运的action，搬运过程中客户端会不断的发回反馈信息，最终完成整个搬运过程．</p><p>本小节的演示源码在课程的演示代码包里,<a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/sychaichangkun/ROS-Academy-for-Beginners">此处为链接</a>.</p><p>首先写handling.action文件,类比如上的格式.包括三个部分,目标,结果,反馈.如下:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># Define the goal</span><br><span class="line">uint32 handling_id </span><br><span class="line">---</span><br><span class="line"># Define the result</span><br><span class="line">uint32 Handling_completed</span><br><span class="line">---</span><br><span class="line"># Define a feedback message</span><br><span class="line">float32 percent_complete</span><br></pre></td></tr></table></figure><p>写完之后修改文件夹里CmakeLists.txt如下内容:</p><ol><li>find_package(catkin REQUIRED genmsg actionlib_msgs actionlib)</li><li>add_action_files(DIRECTORY action FILES DoDishes.action) generate_messages(DEPENDENCIES actionlib_msgs)</li><li>add_action_files(DIRECTORY action FILES Handling.action)</li><li>generate_messages( DEPENDENCIES actionlib_msgs)</li></ol><p>修改package.xml,添加所需要的依赖如下:</p><ol><li><code>actionlib</code></li><li><code>actionlib_msgs</code></li><li><code>actionlib</code></li><li><code>actionlib_msgs</code></li></ol><p>然后回到工作空间 <code>catkin_ws</code>进行编译.</p><p>本例中设置的的action,定义了一个搬运的例子,首先写客户端,实现功能发送action请求,包括进行目标活动,或者目标活动.之后写服务器,实验返回客户端活动当前状态信息,结果信息,和反馈信息.从而实现action.本例测试结果截图如下:</p><p><img src="/img/private/loading-4.gif" data-lazy-src="https://sychaichangkun.gitbooks.io/ros-tutorial-icourse163/content/pics/3.7.1.png" alt="img"> <img src="/img/private/loading-4.gif" data-lazy-src="https://sychaichangkun.gitbooks.io/ros-tutorial-icourse163/content/pics/3.7.2.png" alt="img"> <img src="/img/private/loading-4.gif" data-lazy-src="https://sychaichangkun.gitbooks.io/ros-tutorial-icourse163/content/pics/3.7.3.png" alt="img"> <img src="/img/private/loading-4.gif" data-lazy-src="https://sychaichangkun.gitbooks.io/ros-tutorial-icourse163/content/pics/3.7.4.png" alt="img"></p><h2 id="124-小结"><a class="markdownIt-Anchor" href="#124-小结"></a> 12.4. 小结</h2><p>至此，<strong>ROS通信架构的四种通信方式</strong>就介绍结束，我们可以对比学习这四种通信方式，去思考每一种通信的优缺点和适用条件，在正确的地方用正确的通信方式，这样整个ROS的通信会更加高效，机器人也将更加的灵活和智能。机器人学会了通信，也就相当于有了“灵魂”。</p><h1 id="13-常见srv类型"><a class="markdownIt-Anchor" href="#13-常见srv类型"></a> 13. 常见srv类型</h1><p>本小节介绍常见的srv类型及其定义 srv类型相当于两个message通道，一个发送，一个接收</p><p><strong>AddTwoInts.srv</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">#对两个整数求和，虚线前是输入量，后是返回量</span><br><span class="line">#文件位置：自定义srv文件</span><br><span class="line">int32 a</span><br><span class="line">int32 b</span><br><span class="line">---</span><br><span class="line">int32 sum</span><br></pre></td></tr></table></figure><p><strong>Empty.srv</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#文件位置：std_srvs/Empty.srv</span><br><span class="line">#代表一个空的srv类型</span><br><span class="line"></span><br><span class="line">---</span><br></pre></td></tr></table></figure><p><strong>GetMap.srv</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#文件位置:nav_msgs/GetMap.srv</span><br><span class="line">#获取地图，注意请求部分为空</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line">nav_msgs/OccupancyGrid map</span><br></pre></td></tr></table></figure><p><strong>GetPlan.srv</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">#文件位置:nav_msgs/GetPlan.srv</span><br><span class="line">#得到一条从当前位置到目标点的路径</span><br><span class="line">geometry_msgs/PoseStamped start        #起始点</span><br><span class="line">geometry_msgs/PoseStamped goal        #目标点</span><br><span class="line">float32 tolerance    #到达目标点的x，y方向的容错距离</span><br><span class="line">---</span><br><span class="line">nav_msgs/Path plan</span><br></pre></td></tr></table></figure><p><strong>SetBool.srv</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#文件位置：std_srvs/SetBools.srv</span><br><span class="line">bool data # 启动或者关闭硬件</span><br><span class="line">---</span><br><span class="line">bool success   # 标示硬件是否成功运行</span><br><span class="line">string message # 运行信息</span><br></pre></td></tr></table></figure><p><strong>SetCameraInfo.srv</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">#文件位置:sensor_msgs/SetCameraInfo.srv</span><br><span class="line">#通过给定的CameraInfo相机信息，来对相机进行标定</span><br><span class="line">sensor_msgs/CameraInfo camera_info        #相机信息</span><br><span class="line">---</span><br><span class="line">bool success            #如果调用成功，则返回true</span><br><span class="line">string status_message    #给出调用成功的细节</span><br></pre></td></tr></table></figure><p><strong>SetMap.srv</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">#文件位置：nav_msgs/SetMap.srv</span><br><span class="line">#以初始位置为基准，设定新的地图</span><br><span class="line">nav_msgs/OccupancyGrid map</span><br><span class="line">geometry_msgs/PoseWithCovarianceStamped initial_pose</span><br><span class="line">---</span><br><span class="line">bool success</span><br></pre></td></tr></table></figure><p><strong>TalkerListener.srv</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#文件位置: 自定义srv文件</span><br><span class="line">---</span><br><span class="line">bool success   # 标示srv是否成功运行</span><br><span class="line">string message # 信息，如错误信息等</span><br></pre></td></tr></table></figure><p><strong>Trigger.srv</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#文件位置:std_srvs/Trigger.srv</span><br><span class="line">---</span><br><span class="line">bool success   # 标示srv是否成功运行</span><br><span class="line">string message # 信息，如错误信息等</span><br></pre></td></tr></table></figure><h1 id="14-常见action类型"><a class="markdownIt-Anchor" href="#14-常见action类型"></a> 14. 常见action类型</h1><p>本小节介绍常见的action类型以及其定义</p><p><strong>AddTwoInts.action</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">#文件位置:自定义action文件</span><br><span class="line">#表示将两个整数求和</span><br><span class="line">int64 a</span><br><span class="line">int64 b</span><br><span class="line">---</span><br><span class="line">int64 sum</span><br><span class="line">---</span><br></pre></td></tr></table></figure><p><strong>AutoDocking.action</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">#文件位置:自定义action文件</span><br><span class="line">#goal</span><br><span class="line">---</span><br><span class="line">#result</span><br><span class="line">string text</span><br><span class="line">---</span><br><span class="line">#feedback</span><br><span class="line">string state</span><br><span class="line">string text</span><br></pre></td></tr></table></figure><p><strong>GetMap.action</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">#文件位置:nav_msgs/GetMap.action</span><br><span class="line">#获取地图信息，响应部分为空</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line">nav_msgs/OccupancyGrid map</span><br><span class="line">---</span><br><span class="line">#无返回部分</span><br></pre></td></tr></table></figure><p><strong>MoveBase.action</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#文件位置:geometry_msgs/MoveBase.action</span><br><span class="line">geometry_msgs/PoseStamped target_pose</span><br><span class="line">---</span><br><span class="line">---</span><br><span class="line">geometry_msgs/PoseStamped base_position</span><br></pre></td></tr></table></figure></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者:</span> <span class="post-copyright-info"><a href="mailto:undefined" rel="external nofollow noreferrer">Malloy Yuan</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接:</span> <span class="post-copyright-info"><a href="https://elec-creator.com/posts/8ae22c6d.html">https://elec-creator.com/posts/8ae22c6d.html</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明:</span> <span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="external nofollow noreferrer" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://elec-creator.com" target="_blank">Malloy Yuan 的个人博客</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/ros/">ROS</a></div><div class="post_share"><div class="social-share" data-image="https://cdn.jsdelivr.net/gh/MCUheart/Hexo-blog-data@1.0.2/image/cover/post-cover/ros-cover.jpg" data-sites="facebook,twitter,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload='this.media="all"'><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i> 打赏</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="https://cdn.jsdelivr.net/gh/MCUheart/Hexo-blog-data@1.0.2/image/donate/wechat.jpg" rel="external nofollow noreferrer" target="_blank"><img class="post-qr-code-img" src="/img/private/loading-4.gif" data-lazy-src="https://cdn.jsdelivr.net/gh/MCUheart/Hexo-blog-data@1.0.2/image/donate/wechat.jpg" alt="Wechat"></a><div class="post-qr-code-desc">Wechat</div></li><li class="reward-item"><a href="https://cdn.jsdelivr.net/gh/MCUheart/Hexo-blog-data@1.0.2/image/donate/alipay.jpg" rel="external nofollow noreferrer" target="_blank"><img class="post-qr-code-img" src="/img/private/loading-4.gif" data-lazy-src="https://cdn.jsdelivr.net/gh/MCUheart/Hexo-blog-data@1.0.2/image/donate/alipay.jpg" alt="Alipay"></a><div class="post-qr-code-desc">Alipay</div></li></ul></div></div><div class="ads-wrap"><ins class="adsbygoogle" style="display:block" data-ad-format="fluid" data-ad-layout-key="-fb+5w+4e-db+86" data-ad-client="ca-pub-6017375467561303" data-ad-slot="3926580292"></ins><script>(adsbygoogle=window.adsbygoogle||[]).push({})</script></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/posts/894a0bcb.html"><img class="prev-cover" src="/img/private/loading-4.gif" data-lazy-src="https://cdn.jsdelivr.net/gh/MCUheart/Hexo-blog-data@1.0.2/image/cover/post-cover/ros-cover.jpg" onerror='onerror=null,src="/img/private/post_img-load-404-1.jpg"' alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">ROS常用指令整理</div></div></a></div><div class="next-post pull-right"><a href="/posts/72d3205.html"><img class="next-cover" src="/img/private/loading-4.gif" data-lazy-src="https://cdn.jsdelivr.net/gh/MCUheart/Hexo-blog-data@1.0.2/image/cover/post-cover/ros-cover.jpg" onerror='onerror=null,src="/img/private/post_img-load-404-1.jpg"' alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">ROS-windows安装ROS环境</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/posts/72d3205.html" title="ROS-windows安装ROS环境"><img class="cover" src="/img/private/loading-4.gif" data-lazy-src="https://cdn.jsdelivr.net/gh/MCUheart/Hexo-blog-data@1.0.2/image/cover/post-cover/ros-cover.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2020-05-07</div><div class="title">ROS-windows安装ROS环境</div></div></a></div><div><a href="/posts/15fa7048.html" title="ROS"><img class="cover" src="/img/private/loading-4.gif" data-lazy-src="https://cdn.jsdelivr.net/gh/MCUheart/Hexo-blog-data@1.0.2/image/cover/post-cover/ros-cover.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2020-03-18</div><div class="title">ROS</div></div></a></div><div><a href="/posts/b74e4547.html" title="ROS学习过程的疑问"><img class="cover" src="/img/private/loading-4.gif" data-lazy-src="https://cdn.jsdelivr.net/gh/MCUheart/Hexo-blog-data@1.0.2/image/cover/post-cover/ros-cover.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2020-07-05</div><div class="title">ROS学习过程的疑问</div></div></a></div><div><a href="/posts/59244a47.html" title="ROS常用工具"><img class="cover" src="/img/private/loading-4.gif" data-lazy-src="https://cdn.jsdelivr.net/gh/MCUheart/Hexo-blog-data@1.0.2/image/cover/post-cover/ros-cover.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2020-05-03</div><div class="title">ROS常用工具</div></div></a></div><div><a href="/posts/894a0bcb.html" title="ROS常用指令整理"><img class="cover" src="/img/private/loading-4.gif" data-lazy-src="https://cdn.jsdelivr.net/gh/MCUheart/Hexo-blog-data@1.0.2/image/cover/post-cover/ros-cover.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2020-07-05</div><div class="title">ROS常用指令整理</div></div></a></div><div><a href="/posts/3b2a603b.html" title="ROS-roscpp"><img class="cover" src="/img/private/loading-4.gif" data-lazy-src="https://cdn.jsdelivr.net/gh/MCUheart/Hexo-blog-data@1.0.2/image/cover/post-cover/ros-cover.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2020-04-28</div><div class="title">ROS-roscpp</div></div></a></div></div></div><hr><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i> <span>评论</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/private/loading-4.gif" data-lazy-src="https://cdn.jsdelivr.net/gh/MCUheart/Hexo-blog-data@1.0.2/image/portrait/portrait-3.jpg" onerror='this.onerror=null,this.src="/img/private/site_img-load-404-1.gif"' alt="avatar"></div><div class="author-info__name">Malloy Yuan</div><div class="author-info__description">__在总结中前进,在反思中提升__个人学习/经历/感悟/项目经验/生活 点滴的记录与分享</div></div><div class="card-info-data is-center"><div class="card-info-data-item"><a href="/archives/"><div class="headline">文章</div><div class="length-num">54</div></a></div><div class="card-info-data-item"><a href="/tags/"><div class="headline">标签</div><div class="length-num">34</div></a></div><div class="card-info-data-item"><a href="/categories/"><div class="headline">分类</div><div class="length-num">37</div></a></div></div><div class="card-info-social-icons is-center"><a class="social-icon" href="http://wpa.qq.com/msgrd?v=3&amp;uin=980298390&amp;site=qq&amp;menu=yes" rel="external nofollow noreferrer" target="_blank" title="QQ"><i class="fab fa-qq"></i></a><a class="social-icon" href="https://weibo.com/u/6622047516" rel="external nofollow noreferrer" target="_blank" title="Weibo"><i class="fab fa-weibo"></i></a><a class="social-icon" href="https://www.zhihu.com/people/yyyml" rel="external nofollow noreferrer" target="_blank" title="Zhihu"><i class="fab fa-zhihu"></i></a><a class="social-icon" href="https://music.163.com/#/user/home?id=19122520" rel="external nofollow noreferrer" target="_blank" title="Neteasy music"><i class="iconfont icon-wangyiyunyinyuemusic1193417easyiconnet"></i></a><a class="social-icon" href="https://space.bilibili.com/432676565" rel="external nofollow noreferrer" target="_blank" title="bilibili"><i class="iconfont icon-bilibili-fill"></i></a><a class="social-icon" href="mailto:yuanml0807@foxmail.com" rel="external nofollow noreferrer" target="_blank" title="Email"><i class="fas fa-envelope"></i></a><a class="social-icon" href="/atom.xml" target="_blank" title="RSS"><i class="fas fa-rss"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn card-announcement-animation"></i><span>公告</span></div><div class="announcement_content">不定时更的个人博客,喜欢记得收藏,欢迎沟通交流</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#1-node"><span class="toc-text">1. Node</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2-master"><span class="toc-text">2. Master</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#3-%E5%90%AF%E5%8A%A8master%E5%92%8Cnode"><span class="toc-text">3. 启动master和node</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#4-rosrun%E5%92%8Crosnode%E5%91%BD%E4%BB%A4"><span class="toc-text">4. rosrun和rosnode命令</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#5-launch%E6%96%87%E4%BB%B6"><span class="toc-text">5. launch文件</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#51-%E7%AE%80%E4%BB%8B"><span class="toc-text">5.1. 简介</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#52-%E5%86%99%E6%B3%95%E4%B8%8E%E6%A0%BC%E5%BC%8F"><span class="toc-text">5.2. 写法与格式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#53-%E7%A4%BA%E4%BE%8B"><span class="toc-text">5.3. 示例</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#54-%E5%B0%8F%E7%BB%93"><span class="toc-text">5.4. 小结</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#6-topic"><span class="toc-text">6. Topic</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#61-%E7%AE%80%E4%BB%8B"><span class="toc-text">6.1. 简介</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#62-topic"><span class="toc-text">6.2. Topic</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#63-%E9%80%9A%E4%BF%A1%E7%A4%BA%E4%BE%8B"><span class="toc-text">6.3. 通信示例</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#64-%E6%93%8D%E4%BD%9C%E5%91%BD%E4%BB%A4"><span class="toc-text">6.4. 操作命令</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#65-%E6%B5%8B%E8%AF%95%E5%AE%9E%E4%BE%8B"><span class="toc-text">6.5. 测试实例</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#66-%E5%B0%8F%E7%BB%93"><span class="toc-text">6.6. 小结</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#7-message"><span class="toc-text">7. Message</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#71-%E7%AE%80%E4%BB%8B"><span class="toc-text">7.1. 简介</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#72-%E7%BB%93%E6%9E%84%E4%B8%8E%E7%B1%BB%E5%9E%8B"><span class="toc-text">7.2. 结构与类型</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#73-%E6%93%8D%E4%BD%9C%E5%91%BD%E4%BB%A4"><span class="toc-text">7.3. 操作命令</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#74-%E5%B8%B8%E8%A7%81message"><span class="toc-text">7.4. 常见message</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#8-service"><span class="toc-text">8. Service</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#81-service"><span class="toc-text">8.1. Service</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#82-%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86"><span class="toc-text">8.2. 工作原理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#821-%E7%AE%80%E4%BB%8B"><span class="toc-text">8.2.1. 简介</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#822-%E8%BF%87%E7%A8%8B"><span class="toc-text">8.2.2. 过程</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#83-topic-vs-service"><span class="toc-text">8.3. topic VS service</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#84-%E6%93%8D%E4%BD%9C%E5%91%BD%E4%BB%A4"><span class="toc-text">8.4. 操作命令</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#85-%E6%B5%8B%E8%AF%95%E5%AE%9E%E4%BE%8B"><span class="toc-text">8.5. 测试实例</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#86-%E5%B0%8F%E7%BB%93"><span class="toc-text">8.6. 小结</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#9-srv"><span class="toc-text">9. Srv</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#91-%E7%AE%80%E4%BB%8B"><span class="toc-text">9.1. 简介</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#92-%E6%93%8D%E4%BD%9C%E5%91%BD%E4%BB%A4"><span class="toc-text">9.2. 操作命令</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#93-%E4%BF%AE%E6%94%B9%E9%83%A8%E5%88%86%E6%96%87%E4%BB%B6"><span class="toc-text">9.3. 修改部分文件</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#10-parameter-server"><span class="toc-text">10. Parameter server</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#101-%E7%AE%80%E4%BB%8B"><span class="toc-text">10.1. 简介</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1011-%E5%AD%97%E5%85%B8%E7%AE%80%E4%BB%8B"><span class="toc-text">10.1.1. 字典简介</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1012-%E7%BB%B4%E6%8A%A4%E6%96%B9%E5%BC%8F"><span class="toc-text">10.1.2. 维护方式</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#102-%E5%91%BD%E4%BB%A4%E8%A1%8C%E7%BB%B4%E6%8A%A4"><span class="toc-text">10.2. 命令行维护</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1021-loaddump%E6%96%87%E4%BB%B6"><span class="toc-text">10.2.1. load&amp;&amp;dump文件</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#103-launch%E6%96%87%E4%BB%B6%E5%86%85%E8%AF%BB%E5%86%99"><span class="toc-text">10.3. launch文件内读写</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#104-node%E6%BA%90%E7%A0%81"><span class="toc-text">10.4. node源码</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#105-%E6%93%8D%E4%BD%9C%E5%AE%9E%E4%BE%8B"><span class="toc-text">10.5. 操作实例</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#106-%E5%8F%82%E6%95%B0%E7%B1%BB%E5%9E%8B"><span class="toc-text">10.6. 参数类型</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#11-action"><span class="toc-text">11. Action</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#111-%E7%AE%80%E4%BB%8B"><span class="toc-text">11.1. 简介</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#12-%E9%80%9A%E4%BF%A1%E5%8E%9F%E7%90%86"><span class="toc-text">12. 通信原理</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#121-action-%E8%A7%84%E8%8C%83"><span class="toc-text">12.1. Action 规范</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#122-action%E8%A7%84%E8%8C%83%E6%96%87%E4%BB%B6%E6%A0%BC%E5%BC%8F"><span class="toc-text">12.2. Action规范文件格式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#123-action%E5%AE%9E%E4%BE%8B%E8%AF%A6%E8%A7%A3"><span class="toc-text">12.3. Action实例详解</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#124-%E5%B0%8F%E7%BB%93"><span class="toc-text">12.4. 小结</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#13-%E5%B8%B8%E8%A7%81srv%E7%B1%BB%E5%9E%8B"><span class="toc-text">13. 常见srv类型</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#14-%E5%B8%B8%E8%A7%81action%E7%B1%BB%E5%9E%8B"><span class="toc-text">14. 常见action类型</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/posts/a8c481ea.html" title="总结基础知识点面(一) 单片机篇"><img src="/img/private/loading-4.gif" data-lazy-src="https://cdn.jsdelivr.net/gh/MCUheart/Hexo-blog-data@1.0.2/image/cover/post-cover/summarization-cover.jpg" onerror='this.onerror=null,this.src="/img/private/post_img-load-404-1.jpg"' alt="总结基础知识点面(一) 单片机篇"></a><div class="content"><a class="title" href="/posts/a8c481ea.html" title="总结基础知识点面(一) 单片机篇">总结基础知识点面(一) 单片机篇</a><time datetime="2020-08-08T16:55:00.000Z" title="发表于 2020-08-09 00:55:00">2020-08-09</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/3a13bccb.html" title="C++ array模板类使用"><img src="/img/private/loading-4.gif" data-lazy-src="https://cdn.jsdelivr.net/gh/MCUheart/Hexo-blog-data@1.0.2/image/cover/post-cover/c++-cover.jpg" onerror='this.onerror=null,this.src="/img/private/post_img-load-404-1.jpg"' alt="C++ array模板类使用"></a><div class="content"><a class="title" href="/posts/3a13bccb.html" title="C++ array模板类使用">C++ array模板类使用</a><time datetime="2020-07-24T14:52:40.000Z" title="发表于 2020-07-24 22:52:40">2020-07-24</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/925153f2.html" title="C++ 代码换行的问题"><img src="/img/private/loading-4.gif" data-lazy-src="https://cdn.jsdelivr.net/gh/MCUheart/Hexo-blog-data@1.0.2/image/cover/post-cover/c++-cover.jpg" onerror='this.onerror=null,this.src="/img/private/post_img-load-404-1.jpg"' alt="C++ 代码换行的问题"></a><div class="content"><a class="title" href="/posts/925153f2.html" title="C++ 代码换行的问题">C++ 代码换行的问题</a><time datetime="2020-07-24T14:24:40.000Z" title="发表于 2020-07-24 22:24:40">2020-07-24</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/dd9d548b.html" title="C++ 对数组进行复制"><img src="/img/private/loading-4.gif" data-lazy-src="https://cdn.jsdelivr.net/gh/MCUheart/Hexo-blog-data@1.0.2/image/cover/post-cover/c++-cover.jpg" onerror='this.onerror=null,this.src="/img/private/post_img-load-404-1.jpg"' alt="C++ 对数组进行复制"></a><div class="content"><a class="title" href="/posts/dd9d548b.html" title="C++ 对数组进行复制">C++ 对数组进行复制</a><time datetime="2020-07-24T14:20:40.000Z" title="发表于 2020-07-24 22:20:40">2020-07-24</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/4858c62f.html" title="C++ vector的用法"><img src="/img/private/loading-4.gif" data-lazy-src="https://cdn.jsdelivr.net/gh/MCUheart/Hexo-blog-data@1.0.2/image/cover/post-cover/c++-cover.jpg" onerror='this.onerror=null,this.src="/img/private/post_img-load-404-1.jpg"' alt="C++ vector的用法"></a><div class="content"><a class="title" href="/posts/4858c62f.html" title="C++ vector的用法">C++ vector的用法</a><time datetime="2020-07-24T14:12:40.000Z" title="发表于 2020-07-24 22:12:40">2020-07-24</time></div></div></div></div><div class="card-widget ads-wrap"><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-6017375467561303" data-ad-slot="4346183088" data-ad-format="auto" data-full-width-responsive="true"></ins><script>(adsbygoogle=window.adsbygoogle||[]).push({})</script></div></div></div></main><footer id="footer" style="background-image:url(https://cdn.jsdelivr.net/gh/MCUheart/Hexo-blog-data@1.0.2/image/top/post-top/ros-top.jpg)"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2022<i style="color:#ff6a6a" class="fa fa-heartbeat"></i>Malloy Yuan</div><div class="footer_custom_text"><a target="_blank" rel="noopener external nofollow noreferrer" href="http://www.beian.miit.gov.cn"><img class="icp-icon" src="/img/private/loading-4.gif" data-lazy-src="/img/private/icp.png"><span>湘ICP备20005957号</span></a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">本地搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i> <span>数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"></div></div><hr><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><script>function panguFn(){"object"==typeof pangu?pangu.autoSpacingPage():getScript("https://cdn.jsdelivr.net/npm/pangu/dist/browser/pangu.min.js").then(()=>{pangu.autoSpacingPage()})}function panguInit(){panguFn()}document.addEventListener("DOMContentLoaded",panguInit)</script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>(()=>{const e=document.querySelectorAll("#article-container .mermaid-wrap");if(e.length){window.runMermaid=()=>{window.loadMermaid=!0;const t="dark"===document.documentElement.getAttribute("data-theme")?"dark":"default";Array.from(e).forEach((e,n)=>{const d=e.firstElementChild,r="mermaid-"+n,i="%%{init:{ 'theme':'"+t+"'}}%%\n"+d.textContent;mermaid.mermaidAPI.render(r,i,e=>{d.insertAdjacentHTML("afterend",e)})})};const t=()=>{window.loadMermaid?runMermaid():getScript("https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js").then(runMermaid)};window.pjax?t():document.addEventListener("DOMContentLoaded",t)}})()</script><script>(()=>{const t=()=>{twikoo.init(Object.assign({el:"#twikoo-wrap",envId:"https://twikoo-five-olive.vercel.app/",region:"",onCommentLoaded:function(){btf.loadLightbox(document.querySelectorAll("#twikoo .tk-content img:not(.vemoji)"))}},null)),GLOBAL_CONFIG_SITE.isPost&&twikoo.getCommentsCount({envId:"https://twikoo-five-olive.vercel.app/",region:"",urls:[window.location.pathname],includeReply:!1}).then((function(t){document.getElementById("twikoo-count").innerText=t[0].count})).catch((function(t){console.error(t)}))},o=()=>{"object"!=typeof twikoo?getScript("https://cdn.jsdelivr.net/npm/twikoo@1.4.15/dist/twikoo.all.min.js").then(t):setTimeout(t,0)};o()})()</script></div><div class="app-refresh" id="app-refresh"><div class="app-refresh-wrap"><label>✨ 网站已更新最新版本 👉</label> <a href="javascript:void(0)" rel="external nofollow noreferrer" onclick="location.reload()">点击刷新</a></div></div><script>function showNotification(){if(GLOBAL_CONFIG.Snackbar){var t="light"===document.documentElement.getAttribute("data-theme")?GLOBAL_CONFIG.Snackbar.bgLight:GLOBAL_CONFIG.Snackbar.bgDark,e=GLOBAL_CONFIG.Snackbar.position;Snackbar.show({text:"已更新最新版本",backgroundColor:t,duration:5e5,pos:e,actionText:"點擊刷新",actionTextColor:"#fff",onActionClick:function(t){location.reload()}})}else{var o=`top: 0; background: ${"light"===document.documentElement.getAttribute("data-theme")?"#49b1f5":"#1f1f1f"};`;document.getElementById("app-refresh").style.cssText=o}}"serviceWorker"in navigator&&(navigator.serviceWorker.controller&&navigator.serviceWorker.addEventListener("controllerchange",(function(){showNotification()})),window.addEventListener("load",(function(){navigator.serviceWorker.register("/sw.js")})))</script><script defer id="fluttering_ribbon" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/canvas-fluttering-ribbon.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful=!0,POWERMODE.shake=!1,POWERMODE.mobile=!1,document.body.addEventListener("input",POWERMODE)</script><script src="//code.tidio.co/xmigmag8yz8wxyxf4rx4tsq9ejzzdqki.js" async></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({pluginRootPath:"live2dw/",pluginJsPath:"lib/",pluginModelPath:"assets/",tagMode:!1,log:!1,model:{jsonPath:"https://cdn.jsdelivr.net/gh/MCUheart/Hexo-blog-data@1.0.2/live2d-widget-model/haru/01/assets/haru01.model.json"},display:{superSample:2,width:150,height:490,position:"left",hOffset:270,vOffset:-50},mobile:{show:!1,scale:.5},react:{opacityDefault:.7,opacityOnHover:.2}})</script></body></html>